# Tools

The server currently offers 11 tools:

#### 1. `insert_cell`

- Insert a cell to specified position with unified API.
- Input:
  - `cell_index`(int): Target index for insertion (0-based). Use -1 to append at end.
  - `cell_type`(string): Type of cell to insert ("code" or "markdown").
  - `cell_source`(string): Source content for the cell.
- Returns: Success message and the structure of its surrounding cells (up to 5 cells above and 5 cells below).

#### 2. `insert_execute_code_cell`

- Insert and execute a code cell in a Jupyter notebook.
- Input:
  - `cell_index`(int): Index of the cell to insert (0-based). Use -1 to append at end and execute.
  - `cell_source`(string): Code source.
- Returns: List of outputs from the executed cell (supports multimodal output including images).

#### 3. `delete_cell`

- Delete a specific cell from the notebook.
- Input:
  - `cell_index`(int): Index of the cell to delete (0-based).
- Returns: Success message.

#### 4. `get_notebook_info`

- Get basic information about the notebook.
- Returns: Dictionary with notebook path, total cells, and cell type counts.

#### 5. `read_cell`

- Read a specific cell from the notebook.
- Input:
  - `cell_index`(int): Index of the cell to read (0-based).
- Returns: Dictionary with cell index, type, source, and outputs (for code cells).

#### 6. `read_all_cells`

- Read all cells from the notebook.
- Returns:  List of cell information including index, type, source, and outputs (for code cells).

#### 7. `list_cell`

- List the basic information of all cells in the notebook.
- Returns a formatted table showing the index, type, execution count (for code cells), and first line of each cell.
- Provides a quick overview of the notebook structure and is useful for locating specific cells for operations.
- Input: None
- Returns: Formatted table string with cell information (Index, Type, Count, First Line).

#### 8. `overwrite_cell_source`

- Overwrite the source of an existing cell.
- Input:
  - `cell_index`(int): Index of the cell to overwrite (0-based).
  - `cell_source`(string): New cell source - must match existing cell type.
- Returns: Success message and diff style.

#### 9. `execute_cell_streaming`

- Execute cell with streaming progress updates. To be used for long-running cells.
- Input:
  - `cell_index`: Index of the cell to execute (0-based)
  - `timeout_seconds`: Maximum time to wait for execution (default: 300s)
  - `progress_interval`: Seconds between progress updates (default: 5s)
- Returns:
  - `list[Union[str, ImageContent]]`: List of outputs including progress updates (supports multimodal output including images)

#### 10. `execute_cell_simple_timeout`

- Execute a cell with simple timeout (no forced real-time sync). To be used for short-running cells. This won't force real-time updates but will work reliably.
- Input:
  - `cell_index`: Index of the cell to execute (0-based)
  - `timeout_seconds`: Maximum time to wait for execution (default: 300s)
- Returns:
  - `list[Union[str, ImageContent]]`: List of outputs from the executed cell (supports multimodal output including images)

#### 11. `execute_cell_with_progress`

- Execute a specific cell with timeout and progress monitoring.
- Input:
  - `cell_index`: Index of the cell to execute (0-based)
  - `timeout_seconds`: Maximum time to wait for execution (default: 300s)
- Returns:
  - `list[Union[str, ImageContent]]`: List of outputs from the executed cell (supports multimodal output including images)

## Multimodal Output Support

The server supports multimodal output, allowing AI agents to directly receive and analyze visual content such as images and charts generated by code execution.

### Supported Output Types

- **Text Output**: Standard text output from code execution
- **Image Output**: PNG images generated by matplotlib, seaborn, plotly, and other visualization libraries
- **Error Output**: Error messages and tracebacks

### Environment Variable Configuration

Control multimodal output behavior using environment variables:

#### `ALLOW_IMG_OUTPUT`

Controls whether to return actual image content or text placeholders.

- **Default**: `true`
- **Values**: `true`, `false`, `1`, `0`, `yes`, `no`, `on`, `off`, `enable`, `disable`, `enabled`, `disabled`

**Example Docker Configuration:**

```json
{
  "mcpServers": {
    "jupyter": {
      "command": "docker",
      "args": [
        "run", "-i", "--rm",
        "-e", "DOCUMENT_URL",
        "-e", "DOCUMENT_TOKEN", 
        "-e", "DOCUMENT_ID",
        "-e", "RUNTIME_URL",
        "-e", "RUNTIME_TOKEN",
        "-e", "ALLOW_IMG_OUTPUT",
        "datalayer/jupyter-mcp-server:latest"
      ],
      "env": {
        "DOCUMENT_URL": "http://host.docker.internal:8888",
        "DOCUMENT_TOKEN": "MY_TOKEN",
        "DOCUMENT_ID": "notebook.ipynb", 
        "RUNTIME_URL": "http://host.docker.internal:8888",
        "RUNTIME_TOKEN": "MY_TOKEN",
        "ALLOW_IMG_OUTPUT": "true"
      }
    }
  }
}
```

### Output Behavior

#### When `ALLOW_IMG_OUTPUT=true` (Default)
- Images are returned as `ImageContent` objects with actual PNG data
- AI agents can directly analyze visual content
- Supports advanced multimodal reasoning

#### When `ALLOW_IMG_OUTPUT=false`
- Images are returned as text placeholders: `"[Image Output (PNG) - Image display disabled]"`
- Maintains backward compatibility with text-only LLMs
- Reduces bandwidth and token usage

### Use Cases

**Data Visualization Analysis:**
```python
import matplotlib.pyplot as plt
import pandas as pd

df = pd.read_csv('sales_data.csv')
df.plot(kind='bar', x='month', y='revenue')
plt.title('Monthly Revenue')
plt.show()
# AI can now "see" and analyze the chart content
```

**Machine Learning Model Visualization:**
```python
import matplotlib.pyplot as plt

# Plot training curves
plt.plot(epochs, train_loss, label='Training Loss')
plt.plot(epochs, val_loss, label='Validation Loss')
plt.legend()
plt.show()
# AI can evaluate training effectiveness from the visual curves
```